<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

    <!-- Global CSS (CSS rules you want applied to all pages) -->
    <link rel="stylesheet" href="/global.css">

    <!-- Page-specific CSS -->
    <link rel="stylesheet" href="posts.css">

    <title>/POSTS</title>

    <!-- Run BEFORE page is finished loading (before window.onload): -->
    <script src="/auth.js"></script>
    <script>
        if (isLoggedIn() === false) window.location.replace("/");
    </script>
</head>
<body>

    <header>
        <h1>POSTS PAGE</h1>
        <nav>
            <a href="./">Home</a>
            <a href="./">Profile</a>
            <button type="button">LOG OUT</button>
            
           </nav>
    </header>
    <select id="search-type-dropdown">
        <option value="">Select one...</option>
        <option value="categories">Search by User</option>
        <option value="all">View All</option>
    </select>
    <div id="user-section" style="display: none;">
        <label for="user-dropdown">User Name</label>
        <select id="user-dropdown">
            <option value="">Select one...</option>
        </select>
    </div>


    <main>

        <table id="posts-table">
            <thead>
                <tr>
                    <th>id</th>
                    <th>text</th>
                    <th>user name</th>
                    <th>Created</th>
                    <th>Likes</th>
            
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

    </main>

    <footer></footer>


    <!-- Bootstrap Bundle (including Popper for popovers) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>

    <!-- Page-specific code -->
    

<script>
(() => {
    const $q = (s) => document.querySelector(s);

    const tbody = $q("#posts-table tbody");

    function loadData() {
        const loginData = getLoginData();
        const options = { 
        method: "GET",
        headers: { 
            // This header is how we authenticate our user with the
            // server for any API requests which require the user
            // to be logged-in in order to have access.
            // In the API docs, these endpoints display a lock icon.
            "content-type": "application/json",
            Authorization: `Bearer ${loginData.token}`,
        },
    };
        return fetch("https://microbloglite.herokuapp.com/api/posts", options)
        .then(response => response.json());
    }



    function fillTable(posts) {
        console.log(posts)
        for (const post of posts) {
            const row = tbody.insertRow(-1);
            let cell1 = row.insertCell(0);
            let cell2 = row.insertCell(1);
            let cell3 = row.insertCell(2);
            let cell4 = row.insertCell(3);
            let cell5 = row.insertCell(4);
            cell5.innerText= post.likes;
            
            cell4.innerText = post.createdAt;
            cell3.innerText = post.username;
            cell2.innerText = post.text;
            cell1.innerText = post._id;

        }
    }

    window.onload = () => {
        loadData().then(data => fillTable(data));
    }


})()
</script>


   
</body>
</html>